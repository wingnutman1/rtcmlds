@model CMS_Web.Models.Incident

@{
    ViewBag.Title = "Uploaded Incident Files";
}

<p class="dataHeader">Incident - Manage Uploaded Files</p>



@(Html.Kendo().Notification()
    .Name("popupNotification")
)

@(Html.HiddenFor(model => model.ID))

<div id="vertical">

    @(Html.Kendo().Grid((IEnumerable<FileInfo>)ViewData["files"])
                .Name("filesGrid")
                .Columns(columns =>
                {
                    columns.Bound(p => p.Name).Title("Files for incident : <b>" + Model.Description + "</b>").Width("90%");
                    columns.Command(command => command.Custom("Delete")
                        .Action("DeleteUploadedFile", "incidents")
                        .DataRouteValues(route =>
                        {
                            route.Add(p => p.Name).RouteKey("fName");
                        })
                    ).Width("10%");

                })
    .Pageable()
    .Sortable()
    .Scrollable()
    .Filterable()
    .HtmlAttributes(new { style = "height:330px; margin-top:10px" })
    .Resizable(resize => resize.Columns(true))

    )

    <form method="post" action='@Url.Action("SubmitCompleteIncidentFiles", new { ID = Model.ID })'>
        <div class="k-content" , style="width:auto; margin-top:10px">
            @(Html.Kendo().Upload()
            .Name("files")
            .Messages(m => m.Select("Select Files to Upload ..."))
            .HtmlAttributes(new { style = "width:100px" })
            )
        </div>

        <input type="submit" value="Upload" class="k-button k-primary" style="margin-top:10px" />
        <span class="k-button" style="float:right; margin-top:10px; margin-bottom:10px">
            @Html.ActionLink("Return to My Open Incidents", "MyOpenIncidents", "Incidents")
        </span>
    </form>

</div>

<style scoped>
    #vertical {
        height: auto;
        width: 1000px;
        margin: 0 auto;
    }
</style>

<!--Reference the SignalR library. -->
<script src="/Scripts/jquery.signalR-2.1.2.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="/signalr/hubs"></script>

<script type="text/javascript">

  $(document).ready(function () {


        var messageHub = $.connection.messageHub;
        var userName = "@HttpContext.Current.User.Identity.Name";

        $.connection.hub.qs = { 'userName': userName };
        var popupNotification = $("#popupNotification").data("kendoNotification");

        if ($.connection.hub.state === $.signalR.connectionState.disconnected) {
        $.connection.hub.start().done(function () {//when the connection is ready,

        popupNotification.show("Server Connection Established");
        });
        }

        messageHub.client.send = function (message) {
        if (message.messageType == "PM")
        popupNotification.show(message.message);
        };


  });

</script>